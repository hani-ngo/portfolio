<!DOCTYPE html>
<html>
<head>
    <title>Generate OG Image</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>
<body>
    <h2>Generating OpenGraph image...</h2>
    <canvas id="ogCanvas" width="1200" height="630" style="border: 1px solid #ccc;"></canvas>
    <br><br>
    <button id="downloadBtn" style="display:none; padding: 10px 20px; background: #4a5568; color: white; border: none; border-radius: 5px; cursor: pointer;">Download og-image.png</button>

    <script>
        // Configure PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        async function generateOGImage() {
            try {
                const canvas = document.getElementById('ogCanvas');
                const ctx = canvas.getContext('2d');
                
                // Load the PDF
                const pdf = await pdfjsLib.getDocument('./portfolio.pdf').promise;
                const page = await pdf.getPage(1);
                
                // Calculate scale to fit 1200x630 optimally
                const viewport = page.getViewport({ scale: 1.0 });
                const scaleX = 1200 / viewport.width;
                const scaleY = 630 / viewport.height;
                const scale = Math.min(scaleX, scaleY);
                
                const scaledViewport = page.getViewport({ scale });
                
                // Create temporary canvas for PDF rendering
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = scaledViewport.width;
                tempCanvas.height = scaledViewport.height;
                
                // Render PDF to temp canvas
                await page.render({
                    canvasContext: tempCtx,
                    viewport: scaledViewport
                }).promise;
                
                // Fill OG canvas with background
                ctx.fillStyle = '#f5f5f5';
                ctx.fillRect(0, 0, 1200, 630);
                
                // Center the PDF page in the OG canvas
                const offsetX = (1200 - scaledViewport.width) / 2;
                const offsetY = (630 - scaledViewport.height) / 2;
                
                ctx.drawImage(tempCanvas, offsetX, offsetY);
                
                // Add subtle overlay text if there's space
                if (offsetY > 40) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.font = 'bold 24px -apple-system, BlinkMacSystemFont, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('Portfolio | Lê Hoàng Anh Ngô', 600, 40);
                }
                
                // Show download button
                document.getElementById('downloadBtn').style.display = 'inline-block';
                
                console.log('OG image generated successfully!');
                
            } catch (error) {
                console.error('Error generating OG image:', error);
                document.body.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        // Download function
        document.getElementById('downloadBtn').addEventListener('click', function() {
            const canvas = document.getElementById('ogCanvas');
            const link = document.createElement('a');
            link.download = 'og-image.png';
            link.href = canvas.toDataURL();
            link.click();
        });
        
        // Generate on page load
        generateOGImage();
    </script>
</body>
</html>